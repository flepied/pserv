#!/bin/sh

pkg="$1"
dep="$pkg"
prefix=pserv
basedep=pserv-base

. pkg/$pkg/config

dest="adminkit-$pkg-$version"

rm -rf build/$dest
mkdir build/$dest
cp -r skel/* build/$dest/
tar c -C pkg/$pkg .|tar x -C build/$dest
rm build/$dest/debian/*.ex build/$dest/debian/*.EX
version=`dpkg-parsechangelog -l build/$dest/debian/changelog| grep ^Version:|cut -d\  -f2`

perl -p -i -e "s/\@pkg\@/$pkg/g;s/\@version\@/$version/g;s/\@extradeps\@/$extradeps/g;s/\@dep\@/$dep/g;s/\@prefix\@/$prefix/g;s/\@basedep\@/$basedep/g" build/$dest/debian/control build/$dest/debian/changelog
cd build/$dest
cd debian
for f in init; do
    if [ -f $f ]; then
	mv $f pserv-$pkg.$f
    fi
done
cd ..
dpkg-buildpackage -rfakeroot

# create-pkg ends here
